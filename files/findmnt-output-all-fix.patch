From 68191a41174a691ac290a04171e9932f2028435a Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Thomas=20Wei=C3=9Fschuh?= <thomas@t-8ch.de>
Date: Thu, 27 Jan 2022 18:00:12 +0100
Subject: [PATCH] findmnt: properly exclude poll columns from --output-all
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Previously columns excluded from --output-all where in fact stored as
column index 0. This however is COL_ACTION which is a polled column
leading to the following error:

findmnt --output-all
findmnt: ACTION column is requested, but --poll is not enabled

Signed-off-by: Thomas Wei√üschuh <thomas@t-8ch.de>
---
 misc-utils/findmnt.c | 7 ++++---
 1 file changed, 4 insertions(+), 3 deletions(-)

diff --git a/misc-utils/findmnt.c b/misc-utils/findmnt.c
index 1c19d608b4..80263d3d73 100644
--- a/misc-utils/findmnt.c
+++ b/misc-utils/findmnt.c
@@ -1492,10 +1492,11 @@ int main(int argc, char *argv[])
 			outarg = optarg;
 			break;
 		case FINDMNT_OPT_OUTPUT_ALL:
-			for (ncolumns = 0; ncolumns < ARRAY_SIZE(infos); ncolumns++) {
-				if (is_tabdiff_column(ncolumns))
+			ncolumns = 0;
+			for (int i = 0; i < ARRAY_SIZE(infos); i++) {
+				if (is_tabdiff_column(i))
 					continue;
-				columns[ncolumns] = ncolumns;
+				columns[ncolumns++] = i;
 			}
 			break;
 		case 'O':
